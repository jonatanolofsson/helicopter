ifndef CONFIG_APP
    error Please specify application (CONFIG_APP)
endif

TOP = $(TUP_CWD)

CFLAGS  = -std=c++0x
CFLAGS += -Wall
CFLAGS += -Werror
CFLAGS += -Wno-unknown-pragmas
CFLAGS += -pedantic-errors
CFLAGS += -Wextra
CFLAGS += -Wcast-align
CFLAGS += -ggdb
CFLAGS += -O0
CFLAGS += -I$(TOP)
CFLAGS += -I$(TOP)/sys/modules
CFLAGS += -I$(TOP)/apps/@(APP)
CFLAGS += -isystem/usr/include/eigen3

TEST_LFLAGS  = -lgtest_main -lgtest
TEST_LFLAGS += -lpthread
TEST_LFLAGS += -L$(TOP)/sys
TEST_LFLAGS += -L$(TOP)/os -los

COMPILER = ccache clang++ -Qunused-arguments
ifdef USE_GCC
    COMPILER = g++
endif

APPLFLAGS += -L$(TOP)/sys
APPLFLAGS += -L$(TOP)/os

!cc = |> ^o^ $(COMPILER) $(CFLAGS) -c %f |> %B.o
!ccapp = | sys/libsys.a os/libos.a |> $(COMPILER) $(CFLAGS) %f $(APPLFLAGS) |> %B
!testcc = | $(TOP)/os/libos.a |> $(COMPILER) $(CFLAGS) %f -o %o $(TEST_LFLAGS) |> %B
!ar = |> ar crs %o %f |> lib%d.a

